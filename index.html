<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="assets/css/reset.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Comfortaa&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/05f187210c.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>

    <title>All Aboard</title>
</head>

<style>
    * {
        box-sizing: border-box;
    }

    body {
        font-family: 'Roboto', sans-serif;
        margin: 0;
        background-color: #474e5d;
    }

    .timeline {
        position: relative;
    }

    /* use the after class to place the line after blank content */
    .timeline::after {
        content: '';
        position: absolute;
        width: 6px;
        background-color: white;
        top: 0;
        bottom: 0;
        left: 50%;
        margin-left: -3px;
    }

    .container {
        padding: 10px 40px;
        position: relative;
        background-color: inherit;
        width: 50vw;
    }

    .container::after {
        content: '';
        position: absolute;
        width: 25px;
        height: 25px;
        right: -16px;
        background-color: white;
        border: 4px solid orange;
        top: 15px;
        border-radius: 50%;
        z-index: 1;
    }

    /* consider nth child differentiate */

    /* .container:nth-child(even) {
        left: 0%;
    } */
    /* .container::after {
        left: 0%;
    } */

    /* .container:nth-child(odd) {
        left: 50%;
    } */

    /* .container:nth-child(odd)::after {
        left: -16px;
    } */

    .arrow::before {
        content: " ";
        height: 0;
        position: absolute;
        top: 22px;
        width: 0;
        z-index: 1;
        right: 30px;
        border: medium solid white;
        border-width: 10px 0px 10px 10px;
        border-color: transparent transparent transparent white;
    }

    /* .arrow:nth-child(even)::before {
        content: " ";
        height: 0;
        position: absolute;
        top: 22px;
        width: 0;
        z-index: 1;
        right: 30px;
        border: medium solid white;
        border-width: 10px 0px 10px 10px;
        border-color: transparent transparent transparent white;
    }

    .arrow:nth-child(odd)::before {
        content: " ";
        height: 0;
        position: absolute;
        top: 22px;
        width: 0;
        z-index: 1;
        left: 30px;
        border: medium solid white;
        border-width: 10px 10px 10px 0px;
        border-color: transparent white transparent transparent;
    } */

    .content {
        padding: 20px 30px;
        background-color: white;
        position: relative;
        border-radius: 10px;
    }

    .button-group {
        display: none;
        margin: 20px 40px;
        right: 40px;
        z-index: 2;
    }

    button {
        z-index: 2;
        padding: 10px;
        border: none;
        border-radius: 25px;
    }

    .train-info {
        display: flex;
        justify-content: space-around;
    }

    #add-trip {
        background-color: green;
        color: white;
    }

    #clear-trip {
        background-color: red;
        color: white;
    }

    #close-click {
        display: none;
    }

    .flex-box-column {
        display: flex;
        flex-direction: column;
    }

    #train-form {
        /* display: none; */
        position: fixed;
        padding: 30px;
        right: 30vh;
        bottom: 20vh;
        background-color: white;
        box-shadow: 10px 15px darkgray;
    }

    label {
        margin: 10px 0px;
        font-size: 20px;
    }

    input {
        font-size: 16px;
        padding: 10px 10px;
        border-radius: 25px;
        border: 1px solid lightgray;
    }

    input:focus {
        outline: none;
    }

    #submit-click {
        margin: 5px 0px;
        background-color: green;
    }

    #close-click {
        margin: 5px 0px;
        background-color: red;
    }

    #all-aboard-title {
        font-family: 'Comfortaa', cursive;
        font-size: 60px;
        text-align: center;
        margin: 35px 0px;
        left: 25px;
        top: 25px;
        color: white;
    }

    @media screen and (max-width: 1050px) {
        .timeline::after {
            left: 95%
        }

        .container {
            width: 95vw;
        }

        #train-form {
            display: none;
            right: 25%;
            bottom: 20vh;
        }

        .button-group {
            display: inherit;
        }

    }
</style>

<body>
    <header>
        <nav>
            <div id="all-aboard-title">
                <h1>All Aboard <i class="fas fa-train"></i></h1>
            </div>
            <div class="button-group">
                <button id="add-trip">Add Trip <i class="fas fa-plus"></i></button>
                <!-- <button id="clear-trip">Clear Trip <i class="fas fa-trash-alt"></i></button> -->
            </div>
        </nav>
    </header>
    <section id="results">
        <div class="timeline"></div>
    </section>
    <section>
        <div id="train-form">
            <form action="">
                <div class="flex-box-column">
                    <h1>Track your Train</h1>
                    <label for=""><i class="fas fa-subway"></i> Train Name</label>
                    <input id="train-name" type="text" placeholder="midnight train..">
                    <label for=""><i class="fas fa-suitcase-rolling"></i> Destination</label>
                    <input id="destination" type="text" placeholder="">
                    <label for=""><i class="fas fa-calendar-check"></i> First Train Time (24:00)</label>
                    <input id="first-time" type="number">
                    <label for=""><i class="fas fa-clock"></i> Frequency</label>
                    <input id="frequency" type="number">
                    <button id="submit-click" type="submit">Submit</button>
                    <button id="close-click">Close</button>
                </div>
            </form>
        </div>
    </section>
    <footer>
    </footer>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/6.1.1/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#config-web-app -->

    <!-- Specific Firebase products we want -->
    <script src="https://www.gstatic.com/firebasejs/6.1.1/firebase-database.js"></script>


    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyCU2YU9R4rNoIGmqxjyELBxMFGRe0SEp1E",
            authDomain: "all-aboard-54dff.firebaseapp.com",
            databaseURL: "https://all-aboard-54dff.firebaseio.com",
            projectId: "all-aboard-54dff",
            storageBucket: "all-aboard-54dff.appspot.com",
            messagingSenderId: "381573422068",
            appId: "1:381573422068:web:1fda06f81dcc1d07"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        //variables
        var database = firebase.database();

        var trainName = ""
        var destination = ""
        var firstTime = ""
        var frequency = ""

        // we need to read a static snapshot of the contents at a given path
        database.ref().on("value", function (snapshot) {
            console.log(snapshot)

            trainName = snapshot.val().trainName;
            destination = snapshot.val().destination;
            firstTime = snapshot.val().fristTime;
            frequency = snapshot.val().frequency;

            // var frequencyMoment = moment(frequency)
            // var firstTimeMoment = moment(firstTime)


            // for testing purposes
            // console.log(trainName)
            // console.log(destination)
            // console.log(firstTime)
            // console.log(frequency)
            // console.log("firstTime moment produces: " + firstTimeMoment)
            // console.log("frequency moment produces: " + frequencyMoment)

            $("#train-name-header").text(trainName)
            $("#destination-header").text(destination)
            $("#firstTime-header").text(firstTime)
            $("#frequency-header").text(frequency)

        }, function (errorObject) {
            console.log("the read failed: " + errorObject.code);
        });

        // submit values placed within the modal
        $("#submit-click").on("click", function () {
            trainName = $("#train-name").val().trim();
            destination = $("#destination").val().trim();
            firstTime = $("#first-time").val().trim();
            frequency = $("#frequency").val().trim();

            $("#train-name-header").text(trainName)
            $("#destination-header").text(destination)
            $("#first-time-header").text(firstTime)
            $("#frequency-header").text(frequency)


            // var frequencyMoment = moment(frequency)
            // var firstTimeMoment = moment(firstTime)

            // console.log("firstTime moment produces: " + firstTimeMoment)
            // console.log("frequency moment produces: " + frequencyMoment)

            // interact with the firebase and push data into variables
            database.ref().push({
                trainName: trainName,
                destination: destination,
                firstTime: firstTime,
                frequency: frequency,
                dateAdded: firebase.database.ServerValue.TIMESTAMP
            })

            // testing purposes
            // console.log(trainName)
            // console.log(destination)
            // console.log(firstTime)
            // console.log(frequency)

        });

        // database changes using child_added
        database.ref().on("child_added", function (snapshot) {
            var sv = snapshot.val();

            // we have to create all of the divs and elements within this area
            // to populate in our app
            var trainIcon = $("<i>")
            var newTrainName = $("<div>").text(sv.trainName)
            var newDestination = $("<div>").text(sv.destination)
            var newFirstTime = $("<div>").text(sv.firstTime)
            var newFrequency = $("<div>").text(sv.frequency)
            var newTrainInfo = $("<div>")
            var newContainer = $("<div>")
            var newContent = $("<div>")
            var timeArrival = $("<div>")
            // .text(displayNextTrain)

            //empty containers
            newTrainInfo.addClass("train-info")
            newContainer.addClass("container arrow")
            newContent.addClass("content")
            trainIcon.addClass("fas fa-train fa-2x")

            //database containers
            newTrainName.addClass("train-name-data")
            newDestination.addClass("destination-data")
            newFirstTime.addClass("first-time-data")
            newFrequency.addClass("frequency-data")
            timeArrival.addClass("time-arrival")

            //testing purposes
            // console.log(sv.trainName)
            // console.log(sv.destination)
            // console.log(sv.firstTime)
            // console.log(sv.frequency)


            //painstaking way of converting time to remindertime till arrival
            var frequencyMoment = sv.frequency
            var firstTimeMoment = sv.firstTime
            var timeConverted = moment(firstTimeMoment, "HH:mm").subtract(1, "years")
            var currentTime = moment();
            var diffTime = moment().diff(moment(timeConverted), "minutes");
            var freqRemainder = diffTime % frequencyMoment;
            var minNextTrain = frequencyMoment - freqRemainder;
            var ltNextTrain = moment().add(minNextTrain, "minutes")
            var displayNextTrain = moment(ltNextTrain).format("LT")


            // testing purposes
            // console.log("firstTime moment produces: " + firstTimeMoment)
            // console.log("frequency moment produces: " + frequencyMoment)
            // console.log("time converted: " + timeConverted)
            // console.log("CURRENT TIME: " + moment(currentTime).format("hh:mm"));
            // console.log("difference in time: " + diffTime)
            // console.log(freqRemainder)
            // console.log("minutes till train: " + minNextTrain)
            // // console.log("arrival time: " + moment(ltNextTrain).format("LT"))
            // console.log("arrival time: " + displayNextTrain)


            // Html to reflect
            $(".timeline").append(newContainer)
            newContainer.append(newContent)

            newContent.append(newTrainInfo)
            // newContent.append(trainIcon)

            newTrainName.prepend("<p>Train Name:</p>")
            newTrainInfo.html(newTrainName)
            newTrainInfo.prepend(trainIcon)

            newDestination.prepend("<p>Destination:</p>")
            newTrainInfo.append(newDestination)

            newFirstTime.prepend("<p>First Time:</p>")
            newTrainInfo.append(newFirstTime)

            newFrequency.prepend("<p>Frequency:</p>")
            newTrainInfo.append(newFrequency)

            timeArrival.prepend("<p>Time arrival</p>")
            timeArrival.append(displayNextTrain)
            newTrainInfo.append(timeArrival)
        }, function (errorObject) {
            console.log("Errors handled: " + errorObject.code);
        });

        $("#add-trip").on("click", function () {
            $("#close-click").show()
            $("#train-form").show()
            console.log("A popup form happens")
        })

        $("#close-click").on("click", function () {
            console.log("a form closes")
            $("#train-form").hide()
        })



        //consider what a train schedule must have
        //first we must save all train schedules that works like a todo list
        //seems like i will have to incorporate an object of arrays to accurate couple information together


        //use an if statement to prevent the submit form from submitting

    </script>
</body>

</html>